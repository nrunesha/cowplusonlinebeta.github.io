{% extends "base.html" %}
{% block title %}COW Plus | Shared{% endblock %}
{% block linkdownload %}class = "active"{% endblock %}
{% block content %}
{% for file_data in file_contents %}
    <div>
        <h3>Contents of {{ file_data.filename }}:</h3>
        <form action="/delete" method="post" style="display:inline;">
            <input type="hidden" name="filename" value="{{ file_data.filename }}">
            <button type="submit">Delete</button>
        </form>
        <form action="/download" method="post" style="display:inline;">
            <input type="hidden" name="filename" value="{{ file_data.filename }}">
            <button type="submit">Download</button>
        </form>
        <table border="1">
            {% for row in file_data.content %}
                <tr>
                    {% for cell in row %}
                        <td>{{ cell }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
        <p><strong>Citation:</strong> {{ file_data.citation }}</p>
    </div>
{% endfor %}

<form id="file-upload-form" action="/import.html" method="post" enctype="multipart/form-data">
    <div class="drop-area" id="drop-area">
        <p>Drag & Drop your files here or click to select files</p>
        <input type="file" id="file-input" name="file" multiple style="display: none;">
    </div>
    <ul id="file-list"></ul>
    <div id="metadata-container" style="display: none;">
        <div>
            <label for="author_name">Article or Chapter Author(s):</label>
            <input type="text" id="author_name" name="author_name" required>
        </div>
        <div>
            <label for="article_title">Article or Chapter Title:</label>
            <input type="text" id="article_title" name="article_title" required>
        </div>
        <div>
            <label for="title">Title (Journal, Book, etc.):</label>
            <input type="text" id="title" name="title" required>
        </div>
        <div>
            <label for="inclusive_pages">Inclusive Pages:</label>
            <input type="text" id="inclusive_pages" name="inclusive_pages" required>
        </div>
        <div>
            <label for="volume">Volume (not required):</label>
            <input type="text" id="volume" name="volume">
        </div>
        <div>
            <label for="issue">Issue Number or Designation (not required):</label>
            <input type="text" id="issue" name="issue">
        </div>
        <div>
            <label for="year">Year:</label>
            <input type="text" id="year" name="year" required>
        </div>
        <div>
            <label for="month">Month (not required):</label>
            <input type="text" id="month" name="month">
        </div>
        <p id="citation-message" style="color: red;">This information is required for citation purposes.</p>
    </div>
    <button type="submit" style="display: none;" id="upload-button">Upload</button>
</form>

<style>
    .drop-area {
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
    }
    .drop-area.dragging {
        background-color: #f0f0f0;
        border-color: #00bfff;
    }
    #metadata-container > div {
        margin-bottom: 10px;
    }
</style>

<script>
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    const metadataContainer = document.getElementById('metadata-container');
    const uploadButton = document.getElementById('upload-button');

    dropArea.addEventListener('click', () => fileInput.click());

    dropArea.addEventListener('dragover', (event) => {
        event.preventDefault();
        dropArea.classList.add('dragging');
    });

    dropArea.addEventListener('dragleave', () => {
        dropArea.classList.remove('dragging');
    });

    dropArea.addEventListener('drop', (event) => {
        event.preventDefault();
        dropArea.classList.remove('dragging');

        // Get the dropped files
        const files = event.dataTransfer.files;
        handleFiles(files);
    });

    function handleFiles(files) {
        // Add files to the input element's files property
        const dataTransfer = new DataTransfer();
        for (const file of files) {
            dataTransfer.items.add(file);
        }
        fileInput.files = dataTransfer.files;

        // Clear previous file list
        fileList.innerHTML = '';
        // Display file names
        for (const file of files) {
            const listItem = document.createElement('li');
            listItem.textContent = file.name;
            fileList.appendChild(listItem);
        }

        // Show the metadata input and upload button
        metadataContainer.style.display = 'block';
        uploadButton.style.display = 'block';
    }

    fileInput.addEventListener('change', () => {
        handleFiles(fileInput.files);
    });
</script>
{% endblock %}
